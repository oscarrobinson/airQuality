<!DOCTYPE html>
<html>
	<head>
		<title>London Air Quality - Data Visualisation</title>
		<link rel="stylesheet" href="assets/css/reset.css" type="text/css">
		<!-- <link rel="stylesheet" href="ls/css/animate.css">  -->
		<link rel="stylesheet" href="ls/css/liquid-slider-clean.css">
		<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">

		<script src="http://d3js.org/d3.v3.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="assets/js/jquery.leanModal.min.js"></script>
		<script src="assets/js/trafficChart.js"></script>
		<script src="http://d3js.org/topojson.v1.min.js"></script>
		<script src="http://d3js.org/colorbrewer.v1.min.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
		<script src="http:////cdnjs.cloudflare.com/ajax/libs/jquery.touchswipe/1.6.4/jquery.touchSwipe.js"></script>
		<script src="ls/js/jquery.liquid-slider.min.js"></script>

		<meta name="apple-mobile-web-app-capable" content="yes">
		<link href="apple-touch-icon.png" rel="apple-touch-icon" />
		<link href="apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76" />
		<link href="apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120" />
		<link href="apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" />


		<style>

	
			path:hover{
				fill-opacity: 0.5;
			}

			#viz{
				width:700px;
				height:100%;
				min-height:600px;
				float:right;
			}

			#header{
				height:100px;
				background-color:gray;
				/*margin:0px;*/
			}

			.liquid-slider{
				height:65px;
				margin:0px;
			}

			#data-switch{
				width:50%;
				height:100px;
				margin:0;
				overflow: auto;
			}

			.selection{
				width:200px;
			}

			div.tooltip {         
			  text-align: left;           
			  width: 200px;                  
			  height: 400px;                 
			  padding: 5px;
			  color:white;             
			  font: 18px sans-serif;     
			  background: gray;   
			  border: 0px;      
			  border-radius: 8px;           
			  pointer-events: none;  
			  float:left;
			  margin-left:50px;
			  margin-top: 60px;      
			}

			#scale{
				width:50%;
				height:100px;
				float:right;
				margin-top:-100px;
			}
			#scale svg {
				padding:60px;
				padding-top:20px;
			}

		</style>


	</head>
	<body id="body">
		<div id="header">
			<div id="data-switch">
				<div class="liquid-slider" id="data-select">
					<div id="happiness" class="selection">
						<p class="title">Happiness</p>
					</div>
					<div id="trees"  class="selection">
						<p class="title">Trees</p>
					</div>
					<div id="toilets" class="selection">
						<p class="title">Toilets</p>
					</div>
					<div id="volunteering" class="selection">
						<p class="title">Volunteering</p>
					</div>
				</div>
			</div>
			<div id="scale">
			</div>
		</div>
		<div class="row-fluid">
		<div id="stats"></div>
		<div id="viz"></div>
	<script>

		$(function(){
		     $('#data-select').liquidSlider({
		     	//continuous:false,
		     	hoverArrows: false,
		     	preLoader:false,
		     	slideEaseDuration: 100,
		     	dynamicTabs:true,
		     	includeTitle: true,
		     	autoHeight: false,
		    	mobileUIThreshold: 1025,
		     	callback: function(){
		     		setCurrentLayer();
		     	}
				
		     });
		});

		function setCurrentLayer() {
			var currentLayer = $("#data-switch").find(".currentPanel").find(".panel-wrapper").find(".title").html();
			var selection = 0;
			if(currentLayer==="Happiness"){
				selection = 0;
			}
			else if(currentLayer==="Trees"){
				selection = 1;
			}
			else if(currentLayer==="Toilets"){
				selection = 2;
			}
			else if(currentLayer==="Volunteering"){
				selection = 3;
			}
			update(selection);

		}


		function getScaleColor(color, inc, num, scaleBlockNo){
			var max = 0;
			var min = 0;
			if(num==0){
				max = 8;
				min = 7;
			}
			else if(num==1){
				max = 40000;
				min = 0;
			}
			else if(num==2){
				max = 100;
				min = 0;
			}
			else if(num==3){
				min = 0;
				max = 50;
			}
			console.log(inc+": "+min+" "+max);
			console.log(inc+": "+(min+((max/10)*inc)));
			return color(min+(((max-min)/scaleBlockNo)*inc));

		}

		var width = document.getElementById('viz').clientWidth;
		var height = document.getElementById('viz').clientHeight;

		var bodyWidth = document.getElementById('body').clientWidth;

		console.log(width + "  " + height);

		var div = d3.select("#stats").append("div")
				    .attr("class", "tooltip")
				    .attr("id", "stats")
				    .style("opacity", 0.8)
				    .html("<b>Touch a Borough to view its data</b>");

		var svg = d3.select("#viz").append("svg:svg").attr("width", width).attr("height", height);

		var svg_scale = d3.select('#scale').append("svg").attr("width", (bodyWidth/2)-120).attr("height", 80)
 		
		var update = function(num){

			d3.selectAll("g").remove();

			switch(num){
				case 0:
					var color = d3.scale.linear()
					.domain([7, 8])
			    	.range(["white", "#104E8B"])
			    	break;

			    case 1:
				    var color = d3.scale.linear()
					.domain([0, 40000])
			    	.range(["white", "#104E8B"]);
			    	break;

			    case 2:
				    var color = d3.scale.linear()
					.domain([0, 100])
			    	.range(["white", "#104E8B"]);
			    	break;
			    case 3:
				    var color = d3.scale.linear()
					.domain([0, 50])
			    	.range(["white", "#104E8B"]);
			    	break;
			    }

			d3.json("statgeo.json", function(uk){

						var dMax = 0;
						var dMin = 0;

						//Gets the coordinate data from our dataset.
			            var subunits = topojson.feature(uk, uk.objects.thenewestdict1);

			            var random = function(d){
			            		if (num == 0){
			            			return color(d.properties.happiness);	
			            		}
			            		if (num == 1){
			            			return color(d.properties.trees);
			            		}
			            		if (num == 2){
			            			return color(d.properties.toilets);
			            		}
			            		if (num == 3){
			            			return color(d.properties.volunteering);
			            		}
			            }

			            //Creates a projection which we can apply to the path.
			            var projection = d3.geo.mercator()
			                .center([-0.10,51.5171])
			                .rotate([0,0])
			                .scale(40000)
			                .translate([width / 2, height / 2.3]);

			            var path = d3.geo.path()
			                .projection(projection);

			            svg.append("g")
			            	.attr("class", "boroughs")
			            	.selectAll("path")
			            	.data(topojson.feature(uk, uk.objects.thenewestdict1).features)
			            	.enter().append("path")
			            	.attr("d", path)
			            	.attr("fill", "white")
			            	.attr("stroke", "white")
			            	.attr("id", function(d){return d.properties.Name})
			            	.transition()
				            	.duration(500)
				            	.attr("fill", random)
				            	.attr("stroke", "black")
				            	.attr("stroke-width", "0.35");

						 svg.selectAll("path")
						 	.data(topojson.feature(uk, uk.objects.thenewestdict1).features)
						 	.on("mouseover", function(d){
						 		div.html("<b>" + d.properties.Name  + "</b><br>" 
						 			+ "Happiness: " + d.properties.happiness + "<br>" +
						 			"Number Of Toilets: " + d.properties.toilets+ "<br>"
						 			+ "Trees: " + d.properties.trees + "<br>"
						 			+ "Volunteering: " + d.properties.volunteering+ "% <br>");
						 	});


						 	var scaleBlockNo = 30;

						 	for(i=0; i<scaleBlockNo; i++){
						 	svg_scale.append("rect")
						 		.attr("height", "30px")
						 		.attr("width", ((bodyWidth/2)-120)/scaleBlockNo+"px")
						 		.attr("x", (((bodyWidth/2)-120)/scaleBlockNo)*i+"px")
						 		.style("fill", getScaleColor(color, i, num, scaleBlockNo));
						 	}

/*
						 	svg_scale.append("rect")
						 		.attr("height", "30px")
						 		.attr("width", ((bodyWidth/2)-20)/10+"px")
						 		.attr("x", (((bodyWidth/2)-20)/10)*0+"px")
						 		.style("fill", getScaleColor(color, 0, num));

						 	svg_scale.append("rect")
						 		.attr("height", "30px")
						 		.attr("width", ((bodyWidth/2)-20)/10+"px")
						 		.attr("x", (((bodyWidth/2)-20)/10)*1+"px")
						 		.style("fill", getScaleColor(color, 1, num));

						 	svg_scale.append("rect")
						 		.attr("height", "30px")
						 		.attr("width", ((bodyWidth/2)-20)/10+"px")
						 		.attr("x", (((bodyWidth/2)-20)/10)*2+"px")
						 		.style("fill", getScaleColor(color, 2, num));

						 	svg_scale.append("rect")
						 		.attr("height", "30px")
						 		.attr("width", ((bodyWidth/2)-20)/10+"px")
						 		.attr("x", (((bodyWidth/2)-20)/10)*3+"px")
						 		.style("fill", getScaleColor(color, 3, num));

						 	svg_scale.append("rect")
						 		.attr("height", "30px")
						 		.attr("width", ((bodyWidth/2)-20)/10+"px")
						 		.attr("x", (((bodyWidth/2)-20)/10)*4+"px")
						 		.style("fill", getScaleColor(color, 4, num));

						 	svg_scale.append("rect")
						 		.attr("height", "30px")
						 		.attr("width", ((bodyWidth/2)-20)/10+"px")
						 		.attr("x", (((bodyWidth/2)-20)/10)*5+"px")
						 		.style("fill", getScaleColor(color, 5, num));

						 	svg_scale.append("rect")
						 		.attr("height", "30px")
						 		.attr("width", ((bodyWidth/2)-20)/10+"px")
						 		.attr("x", (((bodyWidth/2)-20)/10)*6+"px")
						 		.style("fill", getScaleColor(color, 6, num));

						 	svg_scale.append("rect")
						 		.attr("height", "30px")
						 		.attr("width", ((bodyWidth/2)-20)/10+"px")
						 		.attr("x", (((bodyWidth/2)-20)/10)*7+"px")
						 		.style("fill", getScaleColor(color, 7, num));

						 	svg_scale.append("rect")
						 		.attr("height", "30px")
						 		.attr("width", ((bodyWidth/2)-20)/10+"px")
						 		.attr("x", (((bodyWidth/2)-20)/10)*8+"px")
						 		.style("fill", getScaleColor(color, 8, num));

						 	svg_scale.append("rect")
						 		.attr("height", "30px")
						 		.attr("width", ((bodyWidth/2)-20)/10+"px")
						 		.attr("x", (((bodyWidth/2)-20)/10)*9+"px")
						 		.style("fill", getScaleColor(color, 9, num));
*/
			});
	}

	

	update(0);
	</script>

	</body>
</html>