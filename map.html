<!DOCTYPE html>
<html>
	<head>
		<title>London Air Quality - Data Visualisation</title>
		<link rel="stylesheet" href="assets/css/reset.css" type="text/css">
		<!-- <link rel="stylesheet" href="ls/css/animate.css">  -->
		<link rel="stylesheet" href="ls/css/liquid-slider.css">
		<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">
		<link rel="stylesheet" href="assets/css/style.css" type="text/css">

		<script src="http://d3js.org/d3.v3.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="assets/js/jquery.leanModal.min.js"></script>
		<script src="assets/js/trafficChart.js"></script>
		<script src="http://d3js.org/topojson.v1.min.js"></script>
		<script src="http://d3js.org/colorbrewer.v1.min.js"></script>

		<meta name="apple-mobile-web-app-capable" content="yes">
		<link href="apple-touch-icon.png" rel="apple-touch-icon" />
		<link href="apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76" />
		<link href="apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120" />
		<link href="apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" />


		<style>
			path:hover{
				fill-opacity: 0.5;
			}
			body{
				background-color: white;
			}

			div.tooltip {         
			  text-align: left;           
			  width: 300px;                  
			  height: 130px;                 
			  padding: 5px;
			  color:white;             
			  font: 18px sans-serif;     
			  background: black;   
			  border: 0px;      
			  border-radius: 8px;           
			  pointer-events: none;         
			}

		</style>


	</head>
	<body>
		<div class="row-fluid">
		<div id="viz" class="span8">
	<script>

		var width = 1024;
		var height = 768;

		var div = d3.select("#stats").append("div")
				    .attr("class", "tooltip")
				    .attr("id", "stats")
				    .style("opacity", 0.8);

		var svg = d3.select("#viz").append("svg:svg").attr("width", width).attr("height", height);
 		
		var update = function(num){

			d3.selectAll("g").remove();

			switch(num){
				case 0:
					var color = d3.scale.linear()
					.domain([150000, 350000])
			    	.range(["white", "#104E8B"])
			    	break;

			    case 1:
				    var color = d3.scale.linear()
					.domain([0, 400000])
			    	.range(["white", "#104E8B"]);
			    	break;

			    case 2:
				    var color = d3.scale.linear()
					.domain([0, 1000])
			    	.range(["white", "#104E8B"]);
			    	break;
			    }

			d3.json("statgeo.json", function(uk){

						//Gets the coordinate data from our dataset.
			            var subunits = topojson.feature(uk, uk.objects.thenewestdict1);

			            var random = function(d){
			            		if (num == 0){
			            			return color(d.properties.avghouseprice);	
			            		};
			            		if (num == 1){
			            			return color(d.properties.population);
			            		};
			            		if (num == 2){
			            			return color(d.properties.peoplepernewhome);
			            		}};

			            //Creates a projection which we can apply to the path.
			            var projection = d3.geo.mercator()
			                .center([-0.10,51.5171])
			                .rotate([0,0])
			                .scale(50000)
			                .translate([width / 2, height / 2.3]);

			            var path = d3.geo.path()
			                .projection(projection);

			            svg.append("g")
			            	.attr("class", "boroughs")
			            	.selectAll("path")
			            	.data(topojson.feature(uk, uk.objects.thenewestdict1).features)
			            	.enter().append("path")
			            	.attr("d", path)
			            	.attr("fill", "white")
			            	.attr("stroke", "white")
			            	.attr("id", function(d){return d.properties.Name})
			            	.transition()
				            	.duration(500)
				            	.attr("fill", random)
				            	.attr("stroke", "black")
				            	.attr("stroke-width", "0.35");

						 svg.selectAll("path")
						 	.data(topojson.feature(uk, uk.objects.thenewestdict1).features)
						 	.on("mouseover", function(d){
						 		div.html("<b>" + d.properties.Name  + "</b><br>" 
						 			+ "Population: " + d.properties.population + "<br>" +
						 			"Average house price: Â£" + d.properties.avghouseprice + "<br>"
						 			+ "Percent renting from landlord: " + d.properties.percentrent + "<br>"
						 			+ "New homes built 2011/2012: " + d.properties.numnewhomes + "<br>" + 
						 			"People per new home built: " + d3.round(d.properties.peoplepernewhome))});
    })
	};

	update(0);
	</script>

	</body>
</html>